centered_barplot(mpg, "manufacturer", scale = "percentage")
centered_barplot(mpg, "manufacturer", scale = "percentage")
centered_barplot(mpg, "manufacturer")+
theme_bw()
#theme(axis.text.x =
#ggplot2::element_text(angle = 45, hjust = 1))
centered_barplot(mpg, "manufacturer")+
theme_bw()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
centered_barplot(mpg, "manufacturer")
centered_barplot(starwars, "species", scale = "count")
#others not in ggplot2, other libraries with nominal variables with many levels?
library(dplyr)
centered_barplot(starwars, "species", scale = "percent")
# Create testing framework template
use_testthat()
use_test(name="centered_barplot")
devtools::document()
devtools::load_all()
centered_barplot(categories, "Category")
centered_barplot(categories, "Category")
rm(list = ls())
devtools::build_vignettes()
library(usethis)
library(roxygen2)
library(devtools)
use_package("dplyr",type="imports")
document()
use_testthat()
usethis::use_test("centered_barplot")
rm(list = ls())
devetools::load_all()
library(usethis)
library(roxygen2)
library(devtools)
load_all()
centered_barplot(mtcars, "cyl")
devtools::document()
check()
.Last.error
check()
setwd("~/Documents/R scripts and data/nomishape package")
write.csv(mpg, "mpg.csv", row.names = FALSE)
data("starwars", package = "dplyr")
write.csv(starwars, "mpg.csv", row.names = FALSE)
data("starwars", package = "dplyr")
write.csv(starwars, "starwars.csv", row.names = FALSE)
data("starwars", package = "dplyr")
head(starwars)
write.csv(starwars,"starwars.csv",
row.names = FALSE)
starwars_csv <- starwars |>
mutate(across(where(is.list), ~ sapply(.x, toString)))
write.csv(starwars_csv, "starwars.csv", row.names = FALSE)
library(dplyr)
starwars_csv <- starwars |>
mutate(across(where(is.list), ~ sapply(.x, toString)))
write.csv(starwars_csv, "starwars.csv", row.names = FALSE)
use_data(mpg, starwars, internal = TRUE, overwrite = TRUE)
#lets´add more data
data("mpg", package = "ggplot2")
use_data(mpg, starwars, internal = TRUE, overwrite = TRUE)
document()
library(devtools)
document()
setwd("~/Documents/R scripts and data/nomishape package/nomiShape")
use_data(mpg, starwars, internal = TRUE, overwrite = TRUE)
library(devtools)
document()
document()
use_data(mpg, starwars, internal = TRUE, overwrite = TRUE)
usethis::use_data(mpg, starwars, overwrite = TRUE)
usethis::use_data(starwars, overwrite = TRUE)
centered_barplot(mpg, "manufacturer")
centered_barplot(starwars, "species")
data("starwars", package = "dplyr")
starwars_csv <- starwars |>
mutate(across(where(is.list), ~ sapply(.x, toString)))
centered_barplot(starwars, "species")
document()
devtools::load_all()
data(package = "nomiShape")
?centered_barplot
devtools::build_vignettes()
devtools::check()
knitr::opts_chunk$set(echo = TRUE)
library(RColorBrewer)#libreria de colores extra
pareto.chart(noticias, ylab="frecuencia",ylab2 = "porcentaje acumulado",
main="Categorías selectivas en las noticias de títulares de prensa",
col=brewer.pal(9,"RdBu"))
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)#varias librerias que trabajan con datos cualitativos y gráficos
library(readxl)#para leer archivos formato excell
library(qcc)#libreria con varias herramientas cualitativas que incluye Diagramas de Pareto
library(tidytext)#conjunto de librerias para limpiar texto
library(tm)#libreria de mineria de textos, "text mining"
library(ggplot2)#libreria de gramática de gráficos
library(RColorBrewer)#libreria de paletas de colores extra
# Cargar los datos de las conversaciones
conversaciones <- read_excel("entrevistas base 2025.xlsx")
names(conversaciones)
# Filtrar las conversaciones por fuente
conversaciones_real <- subset(conversaciones, fuente == "real")
conversaciones_ficticia <- subset(conversaciones, fuente == "ficticia")
# Crear las tablas de frecuencia para cada subconjunto
datos.pareto_real <- table(conversaciones_real$codigo)
datos.pareto_ficticia <- table(conversaciones_ficticia$codigo)
pareto.chart(datos.pareto_real, ylab="frecuencia",ylab2 = "porcentaje acumulado",
main="Frecuencia de códigos en conversaciones cotidianas")
pareto.chart(datos.pareto_ficticia, ylab="frecuencia",ylab2 = "porcentaje acumulado",main="Frecuencia de códigos en conversaciones ficticias")
qcc.options(bg.margin = "white")#pongamos el margen blanco
pareto.chart(datos.pareto_real, ylab="frecuencia",ylab2 = "porcentaje acumulado",
main="Frecuencia de códigos en conversaciones cotidianas",
col=brewer.pal(7,"Accent"))
pareto.chart(datos.pareto_ficticia, ylab="frecuencia",ylab2 = "porcentaje acumulado",main="Frecuencia de códigos en conversaciones ficticias",
col=brewer.pal(7,"Accent"))
# Filtramos las conversaciones reales y ficticias
freq_table_real <- conversaciones %>%
filter(fuente == "real") %>%
count(codigo) %>%
arrange(desc(n)) %>%
mutate(cumulative_percentage = cumsum(n) / sum(n) * 100)
freq_table_ficticia <- conversaciones %>%
filter(fuente == "ficticia") %>%
count(codigo) %>%
arrange(desc(n)) %>%
mutate(cumulative_percentage = cumsum(n) / sum(n) * 100)
max_freq_real <- max(freq_table_real$n)
max_freq_ficticia <- max(freq_table_ficticia$n)
# Gráfico para conversaciones reales
ggplot(freq_table_real, aes(x = reorder(codigo, -n), y = n, fill = n)) +
geom_bar(stat = "identity") +
scale_fill_gradient(low = "blue", high = "orange") +
geom_line(aes(y = cumulative_percentage * max_freq_real / 100, group = 1), color = "red") +
geom_point(aes(y = cumulative_percentage * max_freq_real / 100), color = "red") +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq_real * 100, name = "Frecuencia acumulada")) +
labs(x = "", y = "Frecuencia", title = "Conversaciones Reales") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
head(starwars)
class(starwars)
freq_table <- as.data.frame(table(species))
head(freq_table)
freq_table <- as.data.frame(table(species))
head(freq_table)
species <- starwars$species
freq_table <- as.data.frame(table(species))
head(freq_table)
max_freq <- max(freq_table$Freq)
ggplot(freq_table, aes(x = reorder(Species, -n), y = n, fill = n)) +
geom_bar(stat = "identity") +
scale_fill_gradient(low = "blue", high = "orange") +
geom_line(aes(y = cumulative_percentage * max_freq_real / 100, group = 1), color = "red") +
geom_point(aes(y = cumulative_percentage * max_freq_real / 100), color = "red") +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq_real * 100, name = "Frecuencia acumulada")) +
labs(x = "", y = "Frecuencia", title = "Conversaciones Reales") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
max_freq <- max(freq_table$Freq)
ggplot(freq_table, aes(x = reorder(Species, -n), y = n, fill = n)) +
geom_bar(stat = "identity") +
scale_fill_gradient(low = "blue", high = "orange") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red") +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red") +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Frecuencia acumulada")) +
labs(x = "", y = "Frecuencia", title = "Conversaciones Reales") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
ggplot(freq_table, aes(x = reorder(Species, -n), y = n, fill = n)) +
geom_bar(stat = "identity") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red") +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red") +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Frecuencia acumulada")) +
labs(x = "", y = "Frecuencia", title = "Conversaciones Reales") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
ggplot(freq_table, aes(x = reorder(Species, -Freq), y = Freq)) +
geom_bar(stat = "identity") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red") +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red") +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Frecuencia acumulada")) +
labs(x = "", y = "Frecuencia", title = "Conversaciones Reales") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
ggplot(freq_table, aes(x = reorder(species, -Freq), y = Freq)) +
geom_bar(stat = "identity") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red") +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red") +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Frecuencia acumulada")) +
labs(x = "", y = "Frecuencia", title = "Conversaciones Reales") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
# Datos
species <- starwars$species
freq_table <- as.data.frame(table(species))
# Ordenar por frecuencia descendente
freq_table <- freq_table %>%
arrange(desc(Freq)) %>%
mutate(cumulative = cumsum(Freq),
cumulative_percentage = cumulative / sum(Freq) * 100)
# Gráfico de Pareto
max_freq <- max(freq_table$Freq)
ggplot(freq_table, aes(x = reorder(species, -Freq), y = Freq)) +
geom_bar(stat = "identity", fill = "steelblue") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red", size = 1) +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red", size = 2) +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Frecuencia acumulada (%)")) +
labs(x = "", y = "Frecuencia", title = "Gráfico de Pareto de especies de Star Wars") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(freq_table, aes(x = reorder(species, -Freq), y = Freq)) +
geom_bar(stat = "identity") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red", size = 1) +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red", size = 2) +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Frecuencia acumulada (%)")) +
labs(x = "", y = "Frecuencia", title = "Gráfico de Pareto de especies de Star Wars") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(freq_table, aes(x = reorder(species, -Freq), y = Freq)) +
geom_bar(stat = "identity") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red", size = 1) +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red", size = 2) +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Frecuencia acumulada (%)")) +
labs(x = "", y = "Frequency") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(freq_table, aes(x = reorder(species, -Freq), y = Freq)) +
geom_bar(stat = "identity") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red", size = 1) +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red", size = 2) +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Cummulated frequency (%)")) +
labs(x = "", y = "Frequency") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
use_package("dplyr",type="imports")
document()
df <- species#this is the df with the qualitative variable of interest called "species"
species <- df$species
df <- starwars#this is the df with the qualitative variable of interest called "species"
species <- df$species
freq_table <- as.data.frame(table(species))
head(freq_table)
max_freq <- max(freq_table$Freq)
ggplot(freq_table, aes(x = reorder(species, -Freq), y = Freq)) +
geom_bar(stat = "identity") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red") +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red") +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Frecuencia acumulada")) +
labs(x = "", y = "Frecuencia", title = "Conversaciones Reales") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
df <- starwars#this is the df with the qualitative variable of interest called "species"
species <- df$species
freq_table <- as.data.frame(table(species))
# Order by frequency and calculate cumulative frequency and percentage, needed?
freq_table <- freq_table %>%
arrange(desc(Freq)) %>%
mutate(cumulative = cumsum(Freq),
cumulative_percentage = cumulative / sum(Freq) * 100)
# Pareto figure
max_freq <- max(freq_table$Freq)
#Pareto figure
ggplot(freq_table, aes(x = reorder(species, -Freq), y = Freq)) +
geom_bar(stat = "identity") +
geom_line(aes(y = cumulative_percentage * max_freq / 100, group = 1), color = "red", size = 1) +
geom_point(aes(y = cumulative_percentage * max_freq / 100), color = "red", size = 2) +
scale_y_continuous(sec.axis = sec_axis(~ . / max_freq * 100, name = "Cummulated frequency (%)")) +
labs(x = "", y = "Frequency") +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
#' Pareto Plot for Nominal Variables
#'
#' Creates a Pareto chart for a nominal variable, displaying frequencies
#' and cumulative percentages.
#'
#' @param df A data.frame or tibble containing the variable of interest.
#' @param var Character. Name of the variable to analyze.
#' @param show_table Logical. If TRUE, prints the frequency table with cumulative percentages.
#' @return A ggplot object showing the Pareto chart.
#' @export
pareto <- function(df, var, show_table = TRUE) {
if (!is.data.frame(df)) {
stop("`df` must be a data.frame or tibble.")
}
if (!var %in% names(df)) {
stop("`var` must be a column name in `df`.")
}
if (is.list(df[[var]])) {
stop("`var` must refer to an atomic (non-list) column.")
}
# Frequency table
freq_table <- as.data.frame(table(df[[var]]))
colnames(freq_table) <- c("Category", "Freq")
# Arrange by descending frequency and add cumulative frequency/percentage
freq_table <- freq_table %>%
dplyr::arrange(desc(Freq)) %>%
dplyr::mutate(
cumulative = cumsum(Freq),
cumulative_percentage = cumulative / sum(Freq) * 100
)
# Optionally print table
if (show_table) {
print(freq_table)
}
# Pareto figure
max_freq <- max(freq_table$Freq)
p <- ggplot2::ggplot(freq_table, ggplot2::aes(x = reorder(Category, -Freq), y = Freq)) +
ggplot2::geom_col() +
ggplot2::geom_line(ggplot2::aes(y = cumulative_percentage * max_freq / 100, group = 1),
color = "red", size = 1) +
ggplot2::geom_point(ggplot2::aes(y = cumulative_percentage * max_freq / 100),
color = "red", size = 2) +
ggplot2::scale_y_continuous(
sec.axis = ggplot2::sec_axis(~ . / max_freq * 100, name = "Cumulative frequency (%)")
) +
ggplot2::labs(x = var, y = "Frequency") +
ggplot2::theme_bw() +
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 45, hjust = 1))
return(p)
}
# Example usage:
pareto(starwars, "species", show_table = TRUE)
pareto(mpg, "manufacturer", show_table = TRUE)
#' Pareto Plot for Nominal Variables
#'
#' Creates a Pareto chart for a nominal variable, displaying frequencies
#' and cumulative percentages.
#'
#' @param df A data.frame or tibble containing the variable of interest.
#' @param var Character. Name of the variable to analyze.
#' @param show_table Logical. If TRUE, prints the frequency table with cumulative percentages.
#' @return A ggplot object showing the Pareto chart.
#' @export
pareto <- function(df, var, show_table = TRUE) {
if (!is.data.frame(df)) {
stop("`df` must be a data.frame or tibble.")
}
if (!var %in% names(df)) {
stop("`var` must be a column name in `df`.")
}
if (is.list(df[[var]])) {
stop("`var` must refer to an atomic (non-list) column.")
}
# Frequency table
freq_table <- as.data.frame(table(df[[var]]))
colnames(freq_table) <- c("Category", "Freq")
# Arrange by descending frequency and add cumulative frequency/percentage
freq_table <- freq_table %>%
dplyr::arrange(desc(Freq)) %>%
dplyr::mutate(
cumulative = cumsum(Freq),
cumulative_percentage = cumulative / sum(Freq) * 100
)
# Optionally print table
if (show_table) {
print(freq_table)
}
# Pareto figure
max_freq <- max(freq_table$Freq)
p <- ggplot2::ggplot(freq_table, ggplot2::aes(x = reorder(Category, -Freq), y = Freq)) +
ggplot2::geom_col() +
ggplot2::geom_line(ggplot2::aes(y = cumulative_percentage * max_freq / 100, group = 1),
color = "red", size = 1) +
ggplot2::geom_point(ggplot2::aes(y = cumulative_percentage * max_freq / 100),
color = "red", size = 2) +
ggplot2::scale_y_continuous(
sec.axis = ggplot2::sec_axis(~ . / max_freq * 100, name = "Cumulative frequency (%)")
) +
ggplot2::labs(y = "Frequency") +
ggplot2::theme_bw() +
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 45, hjust = 1))
return(p)
}
# Example usage:
pareto(starwars, "species", show_table = TRUE)
pareto(mpg, "manufacturer", show_table = TRUE)
# Example usage:
pareto(starwars, "species", show_table = TRUE)
#' Pareto Plot for Nominal Variables
#'
#' Creates a Pareto chart for a nominal variable, displaying frequencies
#' and cumulative percentages.
#'
#' @param df A data.frame or tibble containing the variable of interest.
#' @param var Character. Name of the variable to analyze.
#' @param show_table Logical. If TRUE, prints the frequency table with cumulative percentages.
#' @return A ggplot object showing the Pareto chart.
#' @export
pareto <- function(df, var, show_table = TRUE) {
if (!is.data.frame(df)) {
stop("`df` must be a data.frame or tibble.")
}
if (!var %in% names(df)) {
stop("`var` must be a column name in `df`.")
}
if (is.list(df[[var]])) {
stop("`var` must refer to an atomic (non-list) column.")
}
# Frequency table
freq_table <- as.data.frame(table(df[[var]]))
colnames(freq_table) <- c("Category", "Freq")
# Arrange by descending frequency and add cumulative frequency/percentage
freq_table <- freq_table %>%
dplyr::arrange(desc(Freq)) %>%
dplyr::mutate(
cumulative = cumsum(Freq),
cumulative_percentage = cumulative / sum(Freq) * 100
)
# Optionally print table
if (show_table) {
print(freq_table)
}
# Pareto figure
max_freq <- max(freq_table$Freq)
p <- ggplot2::ggplot(freq_table, ggplot2::aes(x = reorder(Category, -Freq), y = Freq)) +
ggplot2::geom_col() +
ggplot2::geom_line(ggplot2::aes(y = cumulative_percentage * max_freq / 100, group = 1),
color = "red", size = 1) +
ggplot2::geom_point(ggplot2::aes(y = cumulative_percentage * max_freq / 100),
color = "red", size = 2) +
ggplot2::scale_y_continuous(
sec.axis = ggplot2::sec_axis(~ . / max_freq * 100, name = "Cumulative frequency (%)")
) +
ggplot2::labs(x = var, y = "Frequency") +
ggplot2::theme_bw() +
ggplot2::theme(axis.text.x = ggplot2::element_text(angle = 45, hjust = 1))
return(p)
}
# Example usage:
pareto(starwars, "species", show_table = TRUE)
pareto(mpg, "manufacturer", show_table = TRUE)
pareto(mpg, "manufacturer", show_table = FALSE)
pareto(mpg, "manufacturer")
pareto(categories, "manufacturer")
pareto(categories, "category")
pareto(categories, "animal")
dir(".")
#better
usethis::use_r("pareto")
document()
?pareto
usethis::use_vignette(
name  = "pareto",
title = "Pareto Plots for Nominal Distributions"
)
library(nomiShape)
pareto(starwars, "species")
pareto(mpg, "manufacturer", show_table = FALSE)
document()
load_all()
rm(list = c("pareto"))
load_all()
document()
document()
load_all()
devtools::build_vignettes()
browseVignettes("nomiShape")# see vignettes
check()
pareto(mpg, "manufacturer", show_table = FALSE)
centered_barplot(mpg, "manufacturer")
pareto(starwars, "species")
#put a and b nexto each other
library(patchwork)
a + b
#put a and b nexto each other
a <- centered_barplot(mpg, "manufacturer")
b <- pareto(mpg, "manufacturer")
#put a and b nexto each other
library(patchwork)
a + b
#put a and b nexto each other
a <- centered_barplot(mpg, "manufacturer")+theme_bw()
b <- pareto(mpg, "manufacturer")
#put a and b nexto each other
library(patchwork)
a + b
pareto(starwars, "species")
centered_barplot(starwars, "species")
document()
pareto(starwars, "species")
centered_barplot(starwars, "species")
devtools::check()
devtools::build()#
devtools::test()
document()
check()
test()
pareto(starwars, "species")
centered_barplot(starwars, "species")
check()
document()
check()
devtools::run_examples()
document()
library(roxygen2)
roxygen2::roxygenise()
export("pareto")
export("pareto")
document()
check()
usethis::use_r("data")
document()
check()
document()
check()
document()
document()
check()
check()
devtools::check(cran = TRUE)    # simulates CRAN check
git init
devtools::install_github("norberello/nomiShape")
